{# vim: foldmethod=marker tabstop=2 shiftwidth=2:
    templates/people/profile.html
#}

{# TODO: liked ministries/campaigns #}
{# TODO: total donated amount #}
{# TODO: campaigns involved in #}
{# TODO: user submissions #}
{# TODO: voting/decision making involved in #}
{# TODO: show linked social media accounts #}
{# TODO: messages #}

<section class="wrapper">
<!-- people/profile -->

    <md-tabs md-dynamic-height md-border-bottom>


      {# {{{ User Profile Section #}
      <md-tab label="My Profile">
        <md-tab-label>
          <md-icon><i class="material-icons">account_circle</i></md-icon>&nbsp;
          My Profile
        </md-tab-label>
        <md-tab-body>
          <form method="POST" enctype="multipart/form-data" action="{{ url_for('people:user_profile') }}">
            <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
            <div layout="column" layout-padding class="md-inline-form">

              {# {{{ INPUT profile_img #}
              <div layout="row">
                <img src="{{ request.user.profile_img_url }}">
                <!-- TODO: dynamically get the updated url from input value via angular -->
                <md-input-container>
                  {{ form.profile_img_url.label_tag() }}
                  {{ form.profile_img_url }}
                </md-input-container>
              </div>

              <div>
                {{ form._profile_img.label_tag() }}
                {{ form._profile_img }}
                <!-- TODO: show previous images for selection -->
                <!-- TODO: unify input via file or url via dialog -->
              </div>
              <br>
              {# }}} #}

              {# {{{ INPUT name (first, last, display_name) #}
              <div layout-gt-sm="row">
                <md-input-container flex-gt-sm=50 style="margin: 0">
                  {# TODO: render WYSIWYG editor #}
                  {{ form.first_name.label_tag() }}
                  {{ form.first_name }}
                </md-input-container>
                <md-input-container flex-gt-sm=50 style="margin: 0">
                  {# TODO: render WYSIWYG editor #}
                  {{ form.last_name.label_tag() }}
                  {{ form.last_name }}
                </md-input-container>
              </div>

              <md-input-container>
                <md-icon><i class="material-icons">face</i></md-icon>
                {{ form.display_name.label_tag() }}
                {{ form.display_name }}
                <div class="hint">Tell us what we should call you!</div>
              </md-input-container>
              {# }}} #}

              {# {{{ INPUT location #}
              <md-input-container>
                {# TODO: render WYSIWYG editor #}
                <md-icon><i class="material-icons">place</i></md-icon>
                {{ form._location.label_tag() }}
                {{ form._location }}
                <div class="hint">Where are you?</div>
                {# TODO: show hint that this can be country, state, or city #}
                {# TODO: show dialog on what this is used for #}
              </md-input-container>
              {# }}} #}

            </div>

            <div id="form_buttons"
                 layout="row"
                 layout-align="start center" layout-align-gt-sm="end center">
              <md-button type="submit" class="md-primary md-raised" flex-gt-sm="25" flex="100">
                <md-icon>
                  <i class="material-icons">save</i>
                </md-icon>
                Save
              </md-button>
            </div>
          </form>
        </md-tab-body>
      </md-tab>
      {# }}} #}

      {# {{{ Ministry Section #}
      <md-tab label="Ministries">
        <md-tab-label>
          <md-icon><i class="material-icons">public</i></md-icon>&nbsp;
          Ministries
        </md-tab-label>
        <md-tab-body>

          <br>
          <md-button class="md-accent" style="text-decoration: none;"
                     ng-href="#{{ url_for('ministry:create_ministry') }}">
            <md-icon>
              <i class="material-icons">add</i>
            </md-icon>
            New Ministry
          </md-button>

          {% if len(request.user.administers.all()) %}

            <md-list>
              <md-subheader>Ministries You Administer:</md-subheader>
              {% for ministry in request.user.administers.all() %}
                <md-list-item class="md-2-line" ng-href="#{{ ministry.url }}">
                  <img src="{{ ministry.profile_img.url }}" class="md-avatar" alt="{{ ministry.name }}">
                  <div class="md-list-item-text" layout="column">
                    <h3>
                      {{ ministry.name }}
                    </h3>
                  </div>
                  <md-button class="md-secondary md-icon-button" ng-href="#{{ url_for('ministry:edit_ministry', kwargs={'ministry_id': ministry.id}) }}">
                    <md-icon>
                      <i class="material-icons">settings</i>
                    </md-icon>
                  </md-button>
                </md-list-item>
              {% endfor %}
            </md-list>

          {% else %}

            <a href="#{{ url_for('ministry:create_ministry') }}"><p>Would you like to create a profile for your Ministry?</p></a>

          {% endif %}
          {% if len(request.user.represents.all()) %}

            <md-list>
              <md-subheader>Ministries You Represent:</md-subheader>
              {% for ministry in request.user.represents.all() %}
                <md-list-item class="md-2-line" ng-href="#{{ ministry.url }}">
                  <img src="{{ static("media" + ministry.profile_img) }}" class="md-avatar" alt="{{ ministry.name }}">
                  <div class="md-list-item-text" layout="column">
                    <h3>
                      {{ ministry.name }}
                    </h3>
                  </div>
                  <md-button class="md-secondary md-icon-button" ng-href="#{{ url_for('ministry:edit_ministry', kwargs={'ministry_id': ministry.id}) }}">
                    <md-icon>
                      <i class="material-icons">settings</i>
                    </md-icon>
                  </md-button>
                </md-list-item>
              {% endfor %}
            </md-list>

          {% endif %}

        </md-tab-body>
      </md-tab>
      {# }}} #}

      {# {{{ Likes Section #}
      <md-tab label="Likes">
        <md-tab-label>
          <md-icon><i class="material-icons">loyalty</i></md-icon>&nbsp;
          Likes
        </md-tab-label>
        <md-tab-body>
          {# TODO: show liked ministries here #}
          <p>This part of the website is under construction.</p>
        </md-tab-body>
      </md-tab>
      {# }}} #}

      {# {{{ Receipts Section #}
      <md-tab label="Receipts">
        <md-tab-label>
          <md-icon><i class="material-icons">receipt</i></md-icon>&nbsp;
          Receipts
        </md-tab-label>
        <md-tab-body>

          <md-tabs md-dynamic-height>

            {# {{{ Donations Subsection #}
            <md-tab label="Donations">
              <md-content>
                {# TODO: cards describing donation statistics #}
                <table>
                  <tr>
                    <td>#</td>
                    <td>Payment Date</td>
                    <td>TX ID</td>
                    <td>Amount</td>
                    <td hide-sm hide-xs>Confirmation</td>
                    <td>Campaign</td>
                    <td hide-sm hide-xs>Ministry</td>
                  </tr>
                  <tr ng-repeat="(num, tx) in donations">
                    {% raw %}
                    <td>{{ num }}</td>
                    <td>
                      <a ng-href="#{{ tx.url }}">{{ tx.payment_date }}</a>
                    </td>
                    <td>
                      <a ng-href="#{{ tx.url }}">{{ tx.id }}</a>
                    </td>
                    <td>{{ tx.amount }}</td>
                    <td hide-sm hide-xs>{{ tx.confirmation }}</td>
                    <td>
                      <a ng-href="#{{ tx.campaign.url }}">{{ tx.campaign.title }}</a>
                    </td>
                    <td hide-sm hide-xs>
                      <a ng-href="#{{ tx.ministry.url }}">{{ tx.ministry.title }}</a>
                    </td>
                    {% endraw %}
                  </tr>
                </table>
              </md-content>
            </md-tab>
            {# }}} #}

            {# {{{ Purchases Subsection #}
            <md-tab label="Purchases">
              <md-content>
                <p>This part of the website is under construction.</p>
              </md-content>
            </md-tab>
            {# }}} #}

          </md-tabs>

        </md-tab-body>

      </md-tab>
      {# }}} #}


    </md-tabs>

</section>


<!-- Google Analytics Virtual Pageview -->
<script>ga('send', 'pageview', 'profile edit')</script>
