{# vim: foldmethod=marker tabstop=2 shiftwidth=2:
    templates/ministry/admin_panel.html
#}
{% extends "layout.html" %}

{% from "ministry/parts/ministry_founded_field.html" import founded_field_initialer %}

{% from "macros/parts/input_field.html" import input_field %}
{% from "macros/parts/input_img_dialog.html" import input_img_dialog %}
{% from "macros/parts/tag_selection.html" import tag_selection, tag_selection_script %}
{% from "macros/parts/wysiwyg_editor.html" import wysiwyg_editor, wysiwyg_script %}

{% block title %}
  New Ministry Application
{% endblock %}

{% block body %}
  <!-- ministry/ministry_application -->

    <section class="wrapper" ng-app="LON" ng-cloak>

        <h4>New Ministry:</h4>
        <!-- TODO: make link for more information -->
        <h6>Please note that all ministry profiles must be approved before they are made public</h6>

        <form method="POST" name="ministryForm" enctype="multipart/form-data"
              action="{{ url_for('ministry:create_ministry') }}">
      <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">

      <div class="row" ng-controller="ministryActionCtrl">
        <div class="row">

          <div class="col s12" id="imageDialogs">
            <div class="row">
              <div class="col s12 m6 l3">
                {{ input_img_dialog('profile', 'Profile Image', imgField=form.profile_img) }}
              </div><!-- /profile_image_dialog -->
              <div class="col s12 m6 l3">
                {{ input_img_dialog('banner', 'Banner Image', imgField=form.banner_img) }}
              </div><!-- /banner_image_dialog -->
            </div>
          </div><!-- /#imageDialogs -->

          {{ input_field(form.name, icon='group', width='s12',
                                     error_text='This name is similar to another ministry',
                                     helper_text="Your ministry's full name") }}

          {# TODO: render custom address input #}
          {{ input_field(form.address, icon='place', width='s12',
                                     helper_text="Your ministry's address or city") }}

          {# TODO: render styled phone number input for any international phone numbers #}
          {{ input_field(form.phone_number, icon='phone', width='l6 s12') }}

          {{ input_field(form.website, icon='explore', width='l6 s12') }}

          {{ input_field(form.staff, icon='people', width='l6 s12') }}

          {{ input_field(form.founded, icon='cake', width='l6 s12') }}

        </div><!-- /details -->

        <div class="row" id="socialMediaLinks">
          <h6>Social Media Links:</h6>
          {# TODO: Add social media Icons #}

          {{ input_field(form.facebook, width='l3 s12') }}
          {{ input_field(form.instagram, width='l3 s12') }}
          {{ input_field(form.youtube, width='l3 s12') }}
          {{ input_field(form.twitter, width='l3 s12') }}

        </div><!-- /#socialMediaLinks -->

        <div id="WYSIWYG">
          <br>
          <i class="material-icons">subject</i>
          {{ form.description.label_tag() }}

          {{ wysiwyg_editor(form.description.name) }}
        </div><!-- /#WYSIWYG -->

        <br>
        <md-input-container layout="column">
          <md-icon><i class="material-icons">class</i></md-icon>
          {{ form.tags.label_tag() }}
          <input type="hidden" name="{{ form.tags.name }}" value="{% raw %}{{ object.tags.join(', ') }}{% endraw %}">
          <md-chips ng-model="object.tags" md-autocomplete-snap
                    md-transform-chip="tagService.transform_chip($chip)"
                    md-separator-keys="tagService.separatorKeys">
            <md-autocomplete
                md-search-text="tagText"
                md-items="tag in filter_tags(tagText)"
                md-item-text="tag"
                md-min-length="1">
              <span md-highlight-text="tagText">{% raw %}{{ tag }}{% endraw %}</span>
            </md-autocomplete>
            <md-chip-template>
                  <span>
                    <span>{% raw %}{{ $chip }}{% endraw %}</span>
                  </span>
            </md-chip-template>
          </md-chips>
          <br><br>
          <div class="hint">Select from existing tags, or create new ones by entering a comma.</div>
        </md-input-container><!-- /tag-selection -->

        <div id="form_buttons" class="row">
          <div class="col l3 s12">
            <button class="btn orange" type="submit">
              <i class="material-icons">save</i>
              Save
            </button>
          </div>
        </div><!-- /#form_buttons -->

      </div><!-- /#details -->
    </form>

  </section>
{% endblock %}


{% block scripts %}
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.6/angular.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.6/angular-animate.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.6/angular-aria.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.6/angular-messages.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.12/angular-material.min.js"></script>

  {% set page_assets = (
  'app.module.js',
  'app.config.js',
  'services/tag.service.js',
  'services/object.service.js',
  'services/select_image_dialog.service.js',
  'people/user_filter.service.js',
  'ministry/ministry_action.controller.js',
  ) %}
  {% for f in page_assets %}
    <script src="{{ static('app/%s' % f) }}"></script>
  {% endfor %}

  {{ wysiwyg_script() }}

  {{ founded_field_initialer() }}

  <!-- Knockout.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.5.0/knockout-min.js"></script>
  <script src="{{ static('js/image_selection.js') }}"></script>
  <script>
    let bannerSelection = new PreviousImageSelection();
    let profileSelection = new PreviousImageSelection();

    ko.applyBindings(bannerSelection, document.getElementById('banner_img_input'));
    ko.applyBindings(profileSelection, document.getElementById('profile_img_input'));
  </script>

{% endblock %}


{% block css %}
  <link rel="stylesheet"
        href="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.12/angular-material.min.css">
{% endblock %}
